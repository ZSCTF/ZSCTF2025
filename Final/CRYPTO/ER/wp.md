通过将曲线 $C$ 的坐标代回原始曲线，我们得到 $ap + q \equiv r \pmod{n}$，其中 $a, r$ 是已知的。如果我们将该方程转换为模 $p$，则得到 $q \equiv r \pmod{p}$。

定义另一个多项式 $f(x) = r - x$，很容易看出 $f(q) = 0 \pmod{p}$。由于 $q$ 相对于 $n$ 较小，我们可以使用 Coppersmith 方法来求解根 $q$ 并分解 $n$。

一旦得到 $p, q$，剩下的部分就应该很容易了。将曲线转换为 $\mathbb{F}_p$ 和 $\mathbb{F}_q$，分别计算其阶，并通过标量乘法的逆运算来获取 flag。